<script  type="text/javascript">
$(function() {
        var iqn_year = $("#iqn_year"),
            iqn_month = $("#iqn_month"),
            iqn_num = $('#iqn_num'),
            iqn_domain = $('#iqn_domain');
        function submit_cluster_add(isforce){
                $(".table").find(".error_tip").hide();
		var bValid = true;
	        bValid = bValid && checkLength( clustername, "ClusterName", 1, 16);  
	        bValid = bValid && checkRegexp( clustername,/^[0-9A-Za-z_]+$/, "ClusterName应由大小写英文字母、数字或下划线构成.");   
                bValid = bValid && checkLength( name, "名称", 3, 16); 
                bValid = bValid && checkRegexp( name, /^[\u4e00-\u9fa50-9A-Za-z_-]+$/, "名称应由中文、大小写英文字母、数字、中划线(英文)或下划线构成.");
                
                bValid = bValid && checkRegexp( iqn_year, /^[0-9]+$/, "IQN 年份必须是数字");
                bValid = bValid && checkLengthnums( iqn_year, "IQN 年份", 4 );
                
                bValid = bValid && checkRegexp( iqn_month, /^[0-9]+$/, "IQN 月份必须是数字");
                bValid = bValid && checkCapacity(iqn_month,"IQN 月份", 01, 12,"IQN 月份必须在01至12之间") ;
                bValid = bValid && checkLength( iqn_month, "IQN 月份", 01,2 );

                if($.trim(iqn_num.val()).length>0){
		    bValid = bValid && checkRegexp( iqn_num, /^[0-9]+$/, "IQN  标识必须是数字");
		    bValid = bValid && checkLength( iqn_num, "IQN 标识", 1,4 );
                }

		bValid = bValid && checkRegexp( iqn_domain, /^[a-z0-9]+$/, "IQN 域名应由小写英文字母或数字构成");
		bValid = bValid && checkLength( iqn_domain, "IQN 域名", 1,63 );
                if (isforce){
                    form_validation=true;  
                }
		if (bValid) {
		   $(".table .error_tip").hide();
		         $(".callback_tip").text("正在提交中......").css({"display":"block","color":'#000'});             		        
                    form_validation=false;  
		    $.post("/cluster",
                           {
                           'option':"{{option}}",
                            'name': $.trim(name.val()),
                            'cluster_name':$.trim(clustername.val()),
                            'isforce':isforce,
                            'iqn_year':$.trim(iqn_year.val()),
                            'iqn_month':$.trim(iqn_month.val()),
                            'iqn_num':$.trim(iqn_num.val()),
                            'iqn_domain':$.trim(iqn_domain.val()),
                            },

		           function(data){
                               if (data.reply.is_success){
			            form_validation=true;
                                    loadhtml("/cluster_list")
                               }else{
                                    error =  data.reply.error;
                                    $(".callback_tip").css("display","block");
                                    $(".callback_tip").text(error);
                                    form_validation=true;
			       }
		           });
//		       }
//		       else
//		       {
//                           $(".callback_tip").text("正在提交中......").css({"display":"block","color":'#000'});             		       
//		       }           
		}
        }
        $("#cluster_create_button").click(function(){ 
            submit_cluster_add(false); 
        });
        var form_validation=true;
        var name = $("#name"),
        clustername = $("#clustername");
});

</script>

<div class="panel panel-default">
    <div class="panel-heading">
            <h3 class="panel-title">新建集群</h3>
    </div>
    <div class="panel-body">
	<p>&nbsp;带<a class="high_tip_red">*</a>号的必填项</p>

        <div class="error_tip callback_tip  cluster_add_err_tip"></div>             	
	<table class="table">
            <tr>
                <td ><label for="clustername">集群名称:<a>*</a></label></td>  
                <td class="tb-item-value">
                <div>(由1至16位大小写英文字母、数字或下划线构成)</div>
                <div class="error_tip"></div>             	
             	<input type="text" name="clustername" id="clustername" style='width:240px'/></td>       
            </tr>
            <tr>
                <td class="tb-item-name"><label for="name">显示名称:<a>*</a></label></td>  
                <td class="tb-item-value">
                <div>(由3至16位中文、大小写英文字母、数字、中划线(英文)或下划线构成)</div>
                <div class="error_tip"></div>             	
                <input type="text" name="name" id="name" style='width:240px'/></td>       
            </tr>	                    
            <tr>
                <td class="tb-item-name"><label for="clustername">端口配置:<a>*</a></label></td>  
                <td class="tb-item-value">
                <div class="error_tip"></div>             	
                <input type="text" name="name" id="iscsi_port" style='width:240px'/></td>       
            </tr>	                    
            <tr>
                <td class="tb-item-name"><label for="clustername">IQN:<a></a></label></td>  
                <td class="tb-item-value">
                    {% if oem == 'h3c' %}
                    <div>IQN的格式例子：iqn.2014-05-1111.com.h3c</div>
                    {% else %}
                    <div>IQN的格式例子：iqn.2014-05-1111.com.meidisen</div>
                    {% endif %}
                    <div class="error_tip"></div>             	
                    <div style="white-space:pre;color:gray;margin:8px 0px;"  class="shrink"><span>(四位年份)     (两位月份)       (标识为空或1至4位数字)     (域名1至63位字符)</span></div>
                	iqn. &nbsp;<input type="text"  id="iqn_year" style='width:55px' value="{{today.year}}" />
                	- &nbsp; <input type="text" id="iqn_month" style='width:55px' value="{{month}}"/>       
                	- &nbsp; <input type="text" id="iqn_num" style='width:55px' value="" /> .com.
                   {% if oem == 'h3c' %}
                	    &nbsp; <input type="text" id="iqn_domain" style='width:55px' value="h3c"/>
                   {% else %}
                	    &nbsp; <input type="text" id="iqn_domain" style='width:85px' value="huayunwangji"/>
                   {% endif %}
                </td>       
            </tr>
	</table>
    
            <button type="button" class="btn btn-primary" id="cluster_create_button" >确定</button>
            <button type="button" class="btn btn-default">取消</button>

    </div> <!-- panel-body-->
</div> <!-- panel-default-->
